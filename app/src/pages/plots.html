<style>
	.just-padding {
		padding: 15px;
	}

	.list-group.list-group-root {
		padding: 0;
		overflow: hidden;
	}

	.list-group.list-group-root .list-group {
		margin-bottom: 0;
	}

	.list-group.list-group-root .list-group-item {
		border-radius: 0;
		border-width: 1px 0 0 0;
	}

	.list-group.list-group-root > .list-group-item:first-child {
		border-top-width: 0;
	}

	.list-group.list-group-root > .list-group > .list-group-item {
		padding-left: 30px;
	}

	.list-group.list-group-root > .list-group > .list-group > .list-group-item {
		padding-left: 45px;
	}

	.list-group-item .glyphicon {
		margin-right: 5px;
	}

	.dygraph-legend {
		padding: 10px;
		border-radius: 3px;
		margin: 5px;
		box-shadow: 0px 0px 0px 2px rgba(0, 0, 0, 0.20);
		background: rgba(255, 255, 255, 0.8)!important;
		z-index: 100!important;
	}

	.dygraph-legend > * {
		display: block;
	}

	.dygraphDefaultAnnotation {
		line-height: 14px;
		border: 0;
		box-shadow: 1px 1px 2px 1px rgba(0, 0, 0, 0.37);
		color: white !important;
	}

	.placeholder {
        font-size: 0.8em;
        color: #999;
        padding: 1em;
        font-size: 1em;
        text-align: center;
        width: 100%;
        background: #B0B6B9;
        color: #fff;
	}

	#dygraph_box_body .placeholder {
		position: absolute;
		top: 50px;
	}

	#dygraph_container .line {
		visibility: hidden;
		background-color: black;
		position: absolute;
		pointer-events: none;
		width: 1px;
		height: 100%;
		top: 0;
		margin-top: -20px;
	}

	.box-toolbar {
		position: absolute;
		top: 0;
		right: 0;
		padding: 5px;
	}

	.dygraph-box {
		position: relative;
		padding: 0
	}
	.dygraph-axis-label {text-align: center!important}
	.axis-input-block {
		position: absolute;
		z-index: 10
	}

	.axis-input-block input {
		position: absolute;
		display: none;
		border-radius: 3px;
		border: 1px inset #eee;
		padding: 0px 3px;
	}

	.axis-input-block:hover input {
		display: block
	}

	.axis-input-block-left {
		left: -20px;
		top: 0;
		bottom: 0;
		width: 50px;
	}

	.axis-input-block-left-top {
        right: 0px;
        top: 0;
        width: 40px;
	}

	.axis-input-block-left-bottom {
        right: 0px;
        bottom: 0;
        width: 40px;
	}

	.axis-input-block-bottom {
		left: 31px;
		right: 5px;
		bottom: -5px;
		height: 20px;
	}

	.axis-input-block-bottom-left {
		left: 0;
		bottom: 0;
		width: 10em;
	}

	.axis-input-block-bottom-right {
		right: 0;
		bottom: 0;
		width: 10em;
	}

	.box-toolbar .adjustRoll input {
		width: 2em;
		border-radius: 3px;
		border: 1px inset #eee;
		padding: 0px 3px;
	}

    .dygraph-annotation-deviation {
        background-color: red;
        color: white;
    }

    .dygraph-annotation-event, .dygraph-annotation-length {
        background-color: #666;
    }

    .plotpoints tr {
        cursor: pointer;
    }

    #avg_click_box {
        position: fixed;
        width: 250px;
        height: 120px;
        z-index: 11;
    }

    .timeline-events {
        font-size: 0.9em;
    }

    .timeline-events > li {
        margin-bottom: 5px;
    }

    .timeline-events > li > div {
        display: inline;
        margin-right: 10px;
    }

    .timeline-event-template > div {
        margin-bottom: 10px;
    }

    .box.timeline-event-template {
        margin-bottom: 0;
    }
</style>

<div id="avg_click_box" class="box box-default" data-bind="
    visible: is_point_box_visible,
    style: {
        top: point_box_top,
        left: point_box_left
    }
">
    <div class="box-body">
        <p data-bind="text: helpers.formatDate(selected_date())"></p>

        <a class="btn btn-sm btn-default" data-bind="click: getNearestTempPlot">
            <span>Получить ближайший график</span>
        </a>

        <a class="btn btn-sm btn-default" data-bind="click: getAvgHourTempPlot">
            <span>Усреднить за час</span>
        </a>
    </div>
</div>

<section class="content" style="height:100%">
	<div class="row" style="height:100%">
		<div class="col-md-9" style="height:100%">
			<div class="box box-info box-borderless" style="position:relative;min-height:20%">
				<div class="box-header">
					<h3 class="box-title">Давление 	<a class="btn btn-xs" title="В Избранное" data-bind="click: saveFavorite">
                        <i class="fa fa-star"></i>
                    </a></h3>
				</div>

				<div class="box-body dygraph-box">
					<div id="dygraph_avg_container" class="plot" style="    margin-left: -25px;"></div>

					<div class="axis-input-block axis-input-block-left">
						<input class="axis-input-block-left-top" data-bind="value: max_zoom_y">
						<input class="axis-input-block-left-bottom" data-bind="value: min_zoom_y">
					</div>

					<div class="axis-input-block axis-input-block-bottom">
						<input class="axis-input-block-bottom-left" data-bind="
                        textInput: min_zoom_x,
                        jmask: {
                            mask: '00/00/0000 00:00:00',
                            options: {
                                placeholder: '__/__/____ __:__:__'
                            }
                        }
                        ">
						<input class="axis-input-block-bottom-right" data-bind="
                        textInput: max_zoom_x,
                        jmask: {
                            mask: '00/00/0000 00:00:00',
                            options: {
                                placeholder: '__/__/____ __:__:__'
                            }
                        }
                        ">
					</div>
				</div>

				<div class="box-toolbar">
					<a class="" title="Сбросить увеличение" data-bind="click: resetAvgPlotZoom">
						<i class="fa fa-repeat"></i>
					</a>

					<a class="adjustRoll" title="Сглаживание">
						<input class="" placeholder="" type=number data-bind="value: adjustRoll"></input>
					</a>
				</div>
			</div>

			<div id="dygraph_box" class="box box-danger box-borderless" style="position:relative;min-height:80%">
				<div id="dygraph_box_body" class="box-body" style="height: 100%;">
					<div id="dygraph_container" class="plot" data-bind="style: { visibility: is_main_plot_visible() ? 'visible' : 'hidden' }">

					</div>

					<p class="placeholder noselect" data-bind="style: { visibility: is_main_plot_visible() ? 'hidden' : 'visible' }">
						<!-- ko if: current_mode() === 'reference_point' -->
						Выберите точку на графике давления
						<!-- /ko -->

						<!-- ko ifnot: current_mode() === 'reference_point' -->
						Выберите хотя бы одну точку на графике давления
						<!-- /ko -->
					</p>
				</div>
			</div>
		</div>
		<div class="col-md-3">
			<div class="box box-info box-borderless" data-bind="visible: current_mode() === 'normal'">
				<div class="box-header">
					<h3 class="box-title">Точки</h3>
				</div>

				<div class="box-body">
                    <!-- ko ifnot: selected_plots().length === 0 -->
                    <table class="table plotpoints" style="font-size: 0.8em;">
                        <tbody data-bind="foreach: selected_plots">
                            <tr>
                                <td data-bind="
                                text: $index() + 1,
                                style: {
                                    color: color
                                }
                                "></td>
                                <td data-bind="click: $parent.showPoint">
                                    <span data-bind="text: description"></span>
                                </td>
                                <td class="btn-hoverable" data-bind="click: $parent.removePoint">
                                    <i class="fa fa-times"></i>
                                </td>
                                <td class="btn-hoverable" data-bind="click: downloadLAS">
                                    <a title=' Скачать как LAS'><i class="fa fa-download"></i></a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <!-- /ko -->

					<!-- ko if: selected_plots().length === 0 -->
					<p class="placeholder noselect">Выберите хотя бы одну точку на графике давления</p>
					<!-- /ko -->
				</div>
			</div>

			<div class="box box-danger box-borderless" data-bind="visible: current_mode() === 'reference_point'">
				<div class="box-header">
					<h3 class="box-title">Эталонная точка</h3>
				</div>

				<div class="box-body">
					<ul class="list-unstyled">
						<li>Дата: <span data-bind="text: reference_date() || '-'"></span></li>
						<li>Глубина: <span data-bind="text: reference_length() || '-'"></span></li>
						<li>Температура: <span data-bind="text: reference_temp() || '-'"></span></li>
					</ul>
				</div>

				<div class="box-footer">
					<a class="btn btn-sm btn-danger" data-bind="click: saveReferencePoint">
						<span>Сохранить</span>
					</a>
					<a class="btn btn-sm btn-default" data-bind="click: returnToNormalMode">
						<span>Отмена</span>
					</a>
				</div>
			</div>

			<div class="box box-danger box-borderless" data-bind="visible: current_mode() === 'min_length'">
				<div class="box-header">
					<h3 class="box-title">Выбор нуля глубины</h3>
				</div>

				<div class="box-body">
					<ul class="list-unstyled">
						<li>Ноль глубины: <span data-bind="text: min_length"></span></li>
					</ul>
				</div>

				<div class="box-footer">
					<a class="btn btn-sm btn-danger" data-bind="click: saveMinLength">
						<span>Сохранить</span>
					</a>
					<a class="btn btn-sm btn-default" data-bind="click: returnToNormalMode">
						<span>Отмена</span>
					</a>
				</div>
			</div>

			<div class="box box-danger box-borderless" data-bind="visible: current_mode() === 'timeline_event'">
				<div class="box-header">
					<h3 class="box-title">События на таймлайне</h3>
				</div>

				<div class="box-body">
                    <!-- ko if: timeline_events().length === 0 -->
                    <p class="placeholder">У вас пока нет событий</p>
                    <!-- /ko -->

                    <!-- ko ifnot: timeline_events().length === 0 -->
                    <ul class="list-unstyled timeline-events" data-bind="foreach: timeline_events">
                        <li>
                            <!-- ko ifnot: $parent.is_editing_timeline_event() && $parent.current_timeline_event() == $data.id -->
                            <div data-bind="
                                text: short_text
                            "></div>
                            <div>
                                <span data-bind="text: helpers.formatDate(date)"></span>
                            </div>
                            <div class="btn-hoverable" data-bind="click: $parent.editTimelineEvent">
                                <i class="fa fa-pencil"></i>
                            </div>
                            <div class="btn-hoverable" data-bind="click: $parent.removeTimelineEvent">
                                <i class="fa fa-times"></i>
                            </div>
                            <!-- /ko -->

                            <!-- ko if: $parent.is_editing_timeline_event() && $parent.current_timeline_event() == $data.id -->
                            <div>
                                <!-- ko with: $parent -->
                                <div class="box box-default box-borderless timeline-event-template" data-bind="template: { name: 'timeline-event-template' }">
                                </div>
                                <!-- /ko -->
                            </div>
                            <!-- /ko -->
                        </li>
                    </ul>
                    <!-- /ko -->

                    <!-- ko ifnot: is_editing_timeline_event -->
                    <a class="btn btn-sm btn-danger" data-bind="click: addTimelineEvent">
                        <span>Добавить событие</span>
                    </a>
                    <a class="btn btn-sm btn-default" data-bind="click: returnToNormalMode">
                        <span>Отмена</span>
                    </a>
                    <!-- /ko -->

                    <!-- ko if: is_editing_timeline_event() && !current_timeline_event() -->
                    <div class="box box-default box-borderless timeline-event-template" data-bind="template: 'timeline-event-template'"></div>
                    <!-- /ko -->
				</div>
			</div>

            <div class="box box-danger box-borderless" data-bind="visible: current_mode() === 'length_annotation'">
                <div class="box-header">
                    <h3 class="box-title">Конструкционные элементы</h3>
                </div>

                <div class="box-body">
                    <!-- ko if: length_annotations().length === 0 -->
                    <p class="placeholder">У вас пока не отмечены конструкционные элементы</p>
                    <!-- /ko -->

                    <!-- ko ifnot: length_annotations().length === 0 -->
                    <ul class="list-unstyled timeline-events" data-bind="foreach: length_annotations">
                        <li>
                            <!-- ko ifnot: $parent.is_editing_length_annotation() && $parent.current_length_annotation() == $data.id -->
                            <div data-bind="
                                text: short_text
                            "></div>
                            <div>
                                <span data-bind="text: length"></span>
                            </div>
                            <div class="btn-hoverable" data-bind="click: $parent.editLengthAnnotation">
                                <i class="fa fa-pencil"></i>
                            </div>
                            <div class="btn-hoverable" data-bind="click: $parent.removeLengthAnnotation">
                                <i class="fa fa-times"></i>
                            </div>
                            <!-- /ko -->

                            <!-- ko if: $parent.is_editing_length_annotation() && $parent.current_length_annotation() == $data.id -->
                            <div>
                                <!-- ko with: $parent -->
                                <div class="box box-default box-borderless timeline-event-template" data-bind="template: { name: 'length-annotation-template' }">
                                </div>
                                <!-- /ko -->
                            </div>
                            <!-- /ko -->
                        </li>
                    </ul>
                    <!-- /ko -->

                    <!-- ko ifnot: is_editing_length_annotation -->
                    <a class="btn btn-sm btn-danger" data-bind="click: addLengthAnnotation">
                        <span>Добавить элемент</span>
                    </a>
                    <a class="btn btn-sm btn-default" data-bind="click: returnToNormalMode">
                        <span>Отмена</span>
                    </a>
                    <!-- /ko -->

                    <!-- ko if: is_editing_length_annotation() && !current_length_annotation() -->
                    <div class="box box-default box-borderless timeline-event-template" data-bind="template: 'length-annotation-template'"></div>
                    <!-- /ko -->
                </div>
            </div>
		</div>
	</div>
</section>

<script type="text/html" id="timeline-event-template">
    <div>
        <ul class="list-unstyled">
            <li>Дата:
                <input class="axis-input-block-bottom-right" data-bind="
                textInput: timeline_event_date,
                jmask: {
                    mask: '00/00/0000 00:00:00',
                    options: {
                        placeholder: '__/__/____ __:__:__'
                    }
                }
                ">
            </li>
            <li>Краткое обозначение:
                <input data-bind="textInput: timeline_event_short_text">
            </li>
            <li>Описание:
                <input data-bind="textInput: timeline_event_description">
            </li>
        </ul>
    </div>

    <div>
        <a class="btn btn-sm btn-danger" data-bind="click: saveTimelineEvent">
            <span>Сохранить</span>
        </a>
        <a class="btn btn-sm btn-default" data-bind="click: cancelEditingTimelineEvent">
            <span>Отмена</span>
        </a>
    </div>
</script>

<script type="text/html" id="length-annotation-template">
    <div>
        <ul class="list-unstyled">
            <li>Глубина:
                <input class="axis-input-block-bottom-right" data-bind="
                textInput: length_annotation_length
                ">
            </li>
            <li>Краткое обозначение:
                <input data-bind="textInput: length_annotation_short_text">
            </li>
            <li>Описание:
                <input data-bind="textInput: length_annotation_description">
            </li>
        </ul>
    </div>

    <div>
        <a class="btn btn-sm btn-danger" data-bind="click: saveLengthAnnotation">
            <span>Сохранить</span>
        </a>
        <a class="btn btn-sm btn-default" data-bind="click: cancelEditingLengthAnnotation">
            <span>Отмена</span>
        </a>
    </div>
</script>
